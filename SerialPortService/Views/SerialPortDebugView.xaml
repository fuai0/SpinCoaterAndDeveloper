<UserControl
    x:Class="SerialPortService.Views.SerialPortDebugView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:cv="clr-namespace:SerialPortService.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:listbox="clr-namespace:SerialPortService.Extensions"
    xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:prism="http://prismlibrary.com/"
    d:DesignHeight="600"
    d:DesignWidth="800"
    prism:ViewModelLocator.AutoWireViewModel="True"
    mc:Ignorable="d">

    <UserControl.Resources>
        <cv:BoolToForegroundConverter x:Key="BoolToForegroundConverter" />
        <cv:BoolToStringConverter x:Key="BoolToStringConverter" />
        <cv:TypeToStringConverter x:Key="TypeToStringConverter" />
    </UserControl.Resources>

    <Grid>
        <ItemsControl ItemsSource="{Binding SerialPortCfgCollection}">
            <ItemsControl.Template>
                <ControlTemplate>
                    <ScrollViewer CanContentScroll="True" VerticalScrollBarVisibility="Hidden">
                        <VirtualizingStackPanel IsItemsHost="True" />
                    </ScrollViewer>
                </ControlTemplate>
            </ItemsControl.Template>
            <ItemsControl.ItemTemplate>
                <DataTemplate>
                    <GroupBox Header="{Binding IocDiName}">
                        <DockPanel>
                            <StackPanel Width="220" DockPanel.Dock="Left">
                                <TextBlock Foreground="{Binding ConnectSuccess, Converter={StaticResource BoolToForegroundConverter}}" Text="{Binding ConnectSuccess, Converter={StaticResource BoolToStringConverter}, ConverterParameter=1}" />

                                <StackPanel HorizontalAlignment="Right" Orientation="Horizontal">
                                    <TextBlock VerticalAlignment="Center" Text="{DynamicResource SerialPort_PortName}" />
                                    <ComboBox
                                        Width="150"
                                        Margin="10,0,0,0"
                                        HorizontalContentAlignment="Center"
                                        ItemsSource="{Binding SerialPortPortNameCollection}"
                                        SelectedItem="{Binding PortName}" />
                                </StackPanel>
                                <StackPanel HorizontalAlignment="Right" Orientation="Horizontal">
                                    <TextBlock VerticalAlignment="Center" Text="{DynamicResource SerialPort_BaudRate}" />
                                    <ComboBox
                                        Width="150"
                                        Margin="10,0,0,0"
                                        HorizontalContentAlignment="Center"
                                        ItemsSource="{Binding SerialPortBaudRateCollection}"
                                        SelectedItem="{Binding BaudRate}" />
                                </StackPanel>
                                <StackPanel HorizontalAlignment="Right" Orientation="Horizontal">
                                    <TextBlock VerticalAlignment="Center" Text="{DynamicResource SerialPort_Parity}" />
                                    <ComboBox
                                        Width="150"
                                        Margin="10,0,0,0"
                                        HorizontalContentAlignment="Center"
                                        ItemsSource="{Binding SerialPortParityCollection}"
                                        SelectedItem="{Binding Parity}" />
                                </StackPanel>
                                <StackPanel HorizontalAlignment="Right" Orientation="Horizontal">
                                    <TextBlock VerticalAlignment="Center" Text="{DynamicResource SerialPort_StopBits}" />
                                    <ComboBox
                                        Width="150"
                                        Margin="10,0,0,0"
                                        HorizontalContentAlignment="Center"
                                        ItemsSource="{Binding SerialPortStopBitsCollection}"
                                        SelectedItem="{Binding StopBits}" />
                                </StackPanel>
                                <StackPanel HorizontalAlignment="Right" Orientation="Horizontal">
                                    <TextBlock VerticalAlignment="Center" Text="{DynamicResource SerialPort_DataBits}" />
                                    <ComboBox
                                        Width="150"
                                        Margin="10,0,0,0"
                                        HorizontalContentAlignment="Center"
                                        ItemsSource="{Binding SerialPortDataBitsCollection}"
                                        SelectedItem="{Binding DataBits}" />
                                </StackPanel>
                                <StackPanel HorizontalAlignment="Right" Orientation="Horizontal">
                                    <TextBlock VerticalAlignment="Center" Text="{DynamicResource SerialPort_Timeout}" />
                                    <TextBox
                                        Width="130"
                                        Margin="10,0,0,0"
                                        HorizontalContentAlignment="Center"
                                        Text="{Binding Timeout}" />
                                    <TextBlock VerticalAlignment="Center" Text="ms" />
                                </StackPanel>
                                <Button
                                    Margin="30,15,30,0"
                                    Command="{Binding DataContext.SaveCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=ItemsControl}}"
                                    CommandParameter="{Binding}"
                                    Content="{DynamicResource SerialPort_SaveSetting}"
                                    IsEnabled="{Binding OpenButtonIsEnabled}" />
                                <Button
                                    Margin="30,15,30,0"
                                    Command="{Binding DataContext.OpenCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=ItemsControl}}"
                                    CommandParameter="{Binding}"
                                    Content="{DynamicResource SerialPort_Open}"
                                    IsEnabled="{Binding OpenButtonIsEnabled}" />
                                <Button
                                    Margin="30,15,30,0"
                                    Command="{Binding DataContext.CloseCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=ItemsControl}}"
                                    CommandParameter="{Binding}"
                                    Content="{DynamicResource SerialPort_Close}"
                                    IsEnabled="{Binding CloseButtonIsEnabled}" />
                            </StackPanel>
                            <DockPanel Margin="20,0,0,0" DockPanel.Dock="Top">
                                <TextBox
                                    Width="700"
                                    Margin="20,0,0,0"
                                    HorizontalAlignment="Left"
                                    DockPanel.Dock="Left"
                                    Text="{Binding SendDataTextBox}" />
                                <StackPanel
                                    Height="40"
                                    Margin="20,0,0,0"
                                    HorizontalAlignment="Right"
                                    Orientation="Horizontal">

                                    <Button
                                        Width="100"
                                        Margin="10,0,0,0"
                                        Command="{Binding DataContext.SendCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=ItemsControl}}"
                                        CommandParameter="{Binding}"
                                        Content="{DynamicResource SerialPort_Send}" />
                                    <Button
                                        Width="100"
                                        Margin="10,0,0,0"
                                        Command="{Binding DataContext.ClearCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=ItemsControl}}"
                                        CommandParameter="{Binding}"
                                        Content="{DynamicResource SerialPort_Clear}" />
                                </StackPanel>
                            </DockPanel>

                            <Border
                                Height="200"
                                Margin="20,0,0,0"
                                BorderBrush="Gray"
                                BorderThickness="1"
                                CornerRadius="2">
                                <ListBox ItemsSource="{Binding SerialPortDataModelCollection}">
                                    <i:Interaction.Behaviors>
                                        <listbox:ListBoxScrollToBottomExtensions />
                                    </i:Interaction.Behaviors>
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <DockPanel>
                                                <TextBlock Text="{Binding Time, StringFormat={}{0:yyyy-MM-dd HH:mm:ss:fff}}" />
                                                <TextBlock Margin="20,0,0,0" Text="{Binding Type, Converter={StaticResource TypeToStringConverter}}" />
                                                <TextBlock Margin="20,0,0,0" Text="{Binding Data}" />
                                            </DockPanel>
                                        </DataTemplate>

                                    </ListBox.ItemTemplate>
                                </ListBox>
                            </Border>
                        </DockPanel>

                    </GroupBox>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>


    </Grid>
</UserControl>
